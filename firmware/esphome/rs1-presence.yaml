# RS-1 Presence Sensor - ESPHome Configuration
# Hardware: ESP32 + LD2450 mmWave Radar

substitutions:
  name: "rs1-presence"
  friendly_name: "RS-1 Presence Sensor"

esphome:
  name: ${name}
  friendly_name: ${friendly_name}

esp32:
  board: esp32dev
  framework:
    type: arduino

# Enable logging
logger:
  level: DEBUG

# Enable Home Assistant API
api:
  encryption:
    key: !secret api_encryption_key

ota:
  platform: esphome
  password: !secret ota_password

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

  # Enable fallback hotspot (captive portal) in case wifi connection fails
  ap:
    ssid: "${name} Fallback"
    password: !secret ap_password

captive_portal:

# Web server for debugging
web_server:
  port: 80

# UART for LD2450
uart:
  id: uart_ld2450
  tx_pin: GPIO17
  rx_pin: GPIO16
  baud_rate: 256000
  parity: NONE
  stop_bits: 1

# LD2450 Radar Configuration
ld2450:
  id: ld2450_radar
  uart_id: uart_ld2450
  throttle: 500ms

# Binary sensor for presence detection
binary_sensor:
  - platform: ld2450
    ld2450_id: ld2450_radar
    has_target:
      name: "Presence"

# Sensors for target tracking
sensor:
  # Target count
  - platform: ld2450
    ld2450_id: ld2450_radar
    target_count:
      name: "Target Count"

    # Target 1
    target_1:
      x:
        name: "Target 1 X"
      y:
        name: "Target 1 Y"
      speed:
        name: "Target 1 Speed"
      resolution:
        name: "Target 1 Resolution"

    # Target 2
    target_2:
      x:
        name: "Target 2 X"
      y:
        name: "Target 2 Y"
      speed:
        name: "Target 2 Speed"
      resolution:
        name: "Target 2 Resolution"

    # Target 3
    target_3:
      x:
        name: "Target 3 X"
      y:
        name: "Target 3 Y"
      speed:
        name: "Target 3 Speed"
      resolution:
        name: "Target 3 Resolution"

# Zone configuration (optional - uncomment and configure as needed)
# Zones are defined as polygons with up to 8 points
# Coordinates are in mm from sensor origin
#
# Example zone:
# zones:
#   - zone:
#       name: "Zone 1"
#       polygon:
#         - point:
#             x: 0
#             y: 0
#         - point:
#             x: 2000
#             y: 0
#         - point:
#             x: 2000
#             y: 3000
#         - point:
#             x: 0
#             y: 3000

# Status LED (optional - configure based on your ESP32 board)
# light:
#   - platform: status_led
#     name: "Status LED"
#     pin: GPIO2
